


Обмен данными с ЕСИА
=======================================================

Информационная система ЕСИА предназначена для обеспечения однократной аутентификации граждан в государственных информационных системах с использованием технологии SSO.

Взаимодействие пользователя с ЕСИА, его регистрация, аутентификация и поддержание сессий в активном состоянии осуществляется в соответствии с руководством пользователя ЕСИА (см. http://minsvyaz.ru/ru/documents/4240/). 

Интеграция с ЕСИА реализована на основании методических рекомендаций Минкомсвязи (см. http://minsvyaz.ru/ru/documents/4243/).

Для идентификации туристов и предоставления им подробной информации о путевках Система взаимодействует с ЕСИА по следующему алгоритму:

1) пользователь инициализирует сессию аутентификации с Системой посредством перехода по специальной ссылке;

2) Система получает запрос на аутентификацию и перенаправляет на точку авторизации в ЕСИА;

3) пользователь авторизуется в ЕСИА. Далее осуществляется его перенаправление на страницу Системы с перечнем путевок, относящихся к идентифицированному физическому лицу. Идентификация осуществляется по номеру документа, удостоверяющему личность и дату рождения. Если данные поля в профиле пользователя ЕСИА не заполнены, то идентификация не будет осуществлена;

4) после идентификации пользователя ему предоставляется доступ к путевкам, идентифицированным по его персональным данным.

Техническое взаимодействие Системы с ЕСИА осуществляется по следующему алгоритму:

1) при попытке входа через ЕСИА, Система посредством сервиса авторизации запрашивает у пользователя разрешение на доступ к соответствующим ресурсам;

2) Система получает разрешение на доступ (authorization grant) в виде авторизационного кода. Далее Система запрашивает маркер доступа, предъявив авторизационный код сервису авторизации;

3) сервис авторизации аутентифицирует Систему, проверяет авторизационный код и выдает маркер доступа и маркер обновления;

4) Система запрашивает у поставщика ресурса защищенный ресурс, предъявляя маркер доступа;

5) поставщик ресурса проверяет маркер доступа, если он валиден, то разрешает доступ к защищенному ресурсу;

6) Система вновь запрашивает с помощью выданного ранее маркера доступ к защищенному ресурсу. Поставщик ресурса проверяет маркер, обнаруживает, что срок его действия истек, возвращает сообщение об ошибке. Система обращается к сервису авторизации за получением нового маркера доступа, предъявляя маркер обновления. Сервис авторизации проверяет валидность маркера обновления и возвращает два новых маркера: доступа и обновления;

7) после получения Системой маркера доступа, она может неоднократно обращаться за получением соответствующего защищенного ресурса, пока не истечет срок действия этого маркера. По истечении срока действия маркера доступа Системе потребуется получить новый маркер доступа.
Система использует один тип защищенных ресурсов – набор персональных идентификационных данных.
Взаимодействие Системы с ЕСИА осуществляется через протокол авторизации Oauth. На серверах приложений размещаются закрытые и открытые ключи для подписания запросов от Системы к ЕСИА. Открытый ключ передается и регистрируется в ЕСИА при регистрации информационной системы согласно регламенту взаимодействия с ЕСИА (см. http://minsvyaz.ru/ru/documents/4244/).
